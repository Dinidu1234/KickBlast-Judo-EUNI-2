<Page x:Class="KickBlastLuxUI.Views.AthletesPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes">
    <materialDesign:DrawerHost IsRightDrawerOpen="{Binding IsDrawerOpen}">
        <materialDesign:DrawerHost.RightDrawerContent>
            <Border Background="{DynamicResource CardBackgroundBrush}" Width="360" Padding="24">
                <StackPanel>
                    <TextBlock Text="Athlete Details" Style="{StaticResource SectionHeaderText}" Margin="0,0,0,12" />
                    <TextBlock Text="Name" Style="{StaticResource CaptionText}" />
                    <TextBox Text="{Binding Form.Name, UpdateSourceTrigger=PropertyChanged}" />
                    <TextBlock Text="{Binding Form.NameError}" Foreground="Salmon" FontSize="12" />

                    <TextBlock Text="Training Plan" Style="{StaticResource CaptionText}" />
                    <ComboBox ItemsSource="{Binding Plans}" SelectedItem="{Binding Form.SelectedPlan}" DisplayMemberPath="Name" />
                    <TextBlock Text="{Binding Form.PlanError}" Foreground="Salmon" FontSize="12" />

                    <TextBlock Text="Current Weight (kg)" Style="{StaticResource CaptionText}" />
                    <TextBox Text="{Binding Form.CurrentWeight, UpdateSourceTrigger=PropertyChanged}" />
                    <TextBlock Text="{Binding Form.CurrentWeightError}" Foreground="Salmon" FontSize="12" />

                    <TextBlock Text="Category Weight (kg)" Style="{StaticResource CaptionText}" />
                    <TextBox Text="{Binding Form.CategoryWeight, UpdateSourceTrigger=PropertyChanged}" />
                    <TextBlock Text="{Binding Form.CategoryWeightError}" Foreground="Salmon" FontSize="12" />

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
                        <Button Content="Cancel" Style="{StaticResource SecondaryButton}" Command="{Binding CancelCommand}" Margin="0,0,8,0" />
                        <Button Content="Save" Style="{StaticResource PrimaryButton}" Command="{Binding SaveCommand}" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </materialDesign:DrawerHost.RightDrawerContent>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <StackPanel Orientation="Horizontal">
                        <TextBox Width="260" materialDesign:HintAssist.Hint="Search athletes" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />
                        <StackPanel Orientation="Horizontal" Margin="16,0,0,0">
                            <Button Content="All" Style="{StaticResource SecondaryButton}" Command="{Binding PlanFilterCommand}" CommandParameter="All" Margin="0,0,8,0" />
                            <Button Content="Beginner" Style="{StaticResource SecondaryButton}" Command="{Binding PlanFilterCommand}" CommandParameter="Beginner" Margin="0,0,8,0" />
                            <Button Content="Intermediate" Style="{StaticResource SecondaryButton}" Command="{Binding PlanFilterCommand}" CommandParameter="Intermediate" Margin="0,0,8,0" />
                            <Button Content="Elite" Style="{StaticResource SecondaryButton}" Command="{Binding PlanFilterCommand}" CommandParameter="Elite" />
                        </StackPanel>
                    </StackPanel>
                    <Button Grid.Column="1" Content="Add Athlete" Style="{StaticResource PrimaryButton}" Command="{Binding AddCommand}" />
                </Grid>
            </Border>

            <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                <Grid>
                    <DataGrid ItemsSource="{Binding Form.FilteredAthletes}" SelectedItem="{Binding SelectedAthlete}" Height="400">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" />
                            <DataGridTextColumn Header="Plan" Binding="{Binding TrainingPlan.Name}" />
                            <DataGridTextColumn Header="Current" Binding="{Binding CurrentWeight}" />
                            <DataGridTextColumn Header="Category" Binding="{Binding CategoryWeight}" />
                            <DataGridTemplateColumn Header="Actions" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Style="{StaticResource MaterialDesignToolButton}" Command="{Binding DataContext.EditCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding}">
                                                <materialDesign:PackIcon Kind="Pencil" />
                                            </Button>
                                            <Button Style="{StaticResource MaterialDesignToolButton}" Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding}">
                                                <materialDesign:PackIcon Kind="Delete" />
                                            </Button>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding Form.FilteredAthletes.Count, Converter={StaticResource CountToVisibilityConverter}}">
                        <materialDesign:PackIcon Kind="AccountAlert" Width="32" Height="32" Foreground="{DynamicResource SubtleTextBrush}" />
                        <TextBlock Text="No athletes found" Style="{StaticResource BodyText}" />
                    </StackPanel>
                </Grid>
            </Border>
            <Grid Grid.RowSpan="2" Background="#66000000" Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                <ProgressBar />
            </Grid>
        </Grid>
    </materialDesign:DrawerHost>
</Page>
